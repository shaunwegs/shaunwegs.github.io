<!DOCTYPE html>
<html>
	<head>
		<title>RESUME: SHAWN UUEG</title>
	</head>
	<body bgcolor="#333" link="yellow" vlink="cyan" alink="orange" text="white" topmargin="0" leftmargin="0">
		<br>
		<br>
		
		<!-- -- This is a Comment; you can see it in the code, but not on the page.
      
      This is similar to the previous layout, but now it's divided into chunks using
      a table. Tables were not originally meant to be used for layout, but instead
      to organize data for science and academia. People quickly found tables to be
      a great way to control the layout of a page and it became widespread and the
      predominant way to design a webpage structure during the first decade of the
      web.
      ---->  	
		<!-- includes for music player --> 	  
		<!-- midi.js css -->
		<link href="midi/m_player.css" rel="stylesheet" type="text/css">
		
		<!-- midi js files -->
		<script src="midi/WebAudioFontPlayer.js"></script>
		<script src="midi/MIDIFile.js"></script>
		<center>
			<table border="0" width="850" cellpadding="0" cellspacing="0">
				<tbody>
					<tr>
						<td>
							
							<!-- Left Column -->
							<img src="img/code-left.png" width="300">
							<br>
							<script>
			var songChoice = [
				"<a href='#' onclick='pushChoice(0)'>Load Voyager</a>",
				"<a href='#' onclick='pushChoice(1)'>Load Celes</a>",
				"<a href='#' onclick='pushChoice(2)'>Load Terra</a>",
				"<a href='#' onclick='pushChoice(3)'>Load Samy 2</a>",
				];
			var counter = 0;

			function chooseNext() {
  			   if(counter === songChoice.length -1){
   			       counter = 0;
 			   }
   			   else {
  			       counter++;  
   			   }
			   document.getElementById("p1").innerHTML = songChoice[counter];
			}

			function choosePrior() {
  			   if(counter === 0){
   			       counter = songChoice.length -1;
 			   }
   			   else {
  			       counter = counter -1;  
   			   }
			   document.getElementById("p1").innerHTML = songChoice[counter];
			}


		
							</script>
							<table>
								<tbody>
									<tr>
										<td>
											<div id="cntls">
												controls here
											</div>
											
											<!-- Retro Music Box -->
											<div class="player" style="height: 80px; box-shadow: 0 -1px #000; margin-bottom: 0; border-bottom-right-radius: 0; border-bottom-left-radius: 0;">
												<table width="280">
													<tbody>
														<tr>
															<td width="40">
																<a href="#" onclick="choosePrior()">
																	<img src="img/backward.png">
																</a>
															</td>
															<td width="250" valign="middle" colspan="2" bgcolor="#222222">
																<center>
																	<span id="p1">Choose a Song</span>
																</center>
															</td>
															<td width="40" align="right">
																<a href="#" onclick="chooseNext()">
																	<img src="img/forward.png">
																</a>
															</td>
														</tr>
														<tr>
															<td colspan="2">
																<center>
																	<p>
																		<input id="position" type="range" min="0" max="100" value="0" step="1">
																	</p>
																</center>
															</td>
															<td>
																<center>
																	<div style="margin: 0 auto; width: 40px; float: right;">
																		<input type="image" src="img/play.png" align="absmiddle" value="stop" onclick="startPlay()">
																	</div>
																</center>
															</td>
															<td>
																<center>
																	<div style="margin: 0 auto; width: 40px; float: right;">
																		<input type="image" src="img/stop.png" align="absmiddle" value="stop" onclick="stopPlay()">
																	</div>
																</center>
															</td>
														</tr>
													</tbody>
												</table>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</td>
						<td>
							
							<!-- Right Column -->
							<img src="img/draw-lighthouse.png" width="500">
							<p><font size="+2" color="#cc9">SHAWN UUEG</font>
								<br>
							</p>
							<hr><font size="-1">ShaunUueg@hotmail.com</font>
							<br><font size="+1">W. Houston Charter</font>
							<p></p>
							<p><font size="+1" color="#cc9">
									<b>
										<i>School-related Activities</i>
									</b>
								</font>
								<br>
								¬ National Junior Honor Society<br>
								¬ Introductory-level Spanish (1 year)<br>
								¬ School Newspaper - Writer<br>
								¬ Studio Art (8 years)<br>
							</p>
							<p><font size="+1" color="#cc9">
									<b>
										<i>Out-of-school Activities</i>
									</b>
								</font>
								<br>
								¬ Private Studio Art Lessons (5 years)<br>
								¬ Cubscouts - Webelos<br>
								¬ Babysitting<br>
								¬ Karate<br>
							</p>
							<p><font size="+1" color="#cc9">
									<b>
										<i>Projects</i>
									</b>
								</font>
								<br>
								¬ North vs South<br>
								¬ Exploding Hot Dogs<br>
								¬ Ronin Warriors Fan Site<br>
								¬ Forgotten Temple<br>
							</p>
							<p><font size="+1" color="#cc9">
									<b>
										<i>Skills</i>
									</b>
								</font>
								<br>
								¬ HTML w/ Netscape &amp; Internet Explorer<br>
								¬ Online Hosting Services: Tripod, Angelfire, Geocities<br>
								¬ Claris Works (Mac)<br>
								¬ Scenario/Map Editing (Command &amp; Conquer)<br>
							</p>
							<br>
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<hr>
						</td>
					</tr>
				</tbody>
			</table>
		</center>
		<script>
			console.log('start');
			
			var audioContext = null;
			var player = null;
			var reverberator = null;
			var songStart = 0;
			var input = null;
			var currentSongTime = 0;
			var nextStepTime = 0;
			var interval = 0;
			var song = null;
			function pause(song) {
				if(interval){
					clearInterval(interval);
					interval=0;
					player.cancelQueue(audioContext);
				}else{
					startPlay();
				}
			}
			function startPlay() {
				currentSongTime = 0;
				songStart = audioContext.currentTime;
				nextStepTime = audioContext.currentTime;
				var stepDuration = 44 / 1000;
				interval = setInterval(function () {
					if (audioContext.currentTime > nextStepTime - stepDuration) {
						sendNotes(song, songStart, currentSongTime, currentSongTime + stepDuration, audioContext, input, player);
						currentSongTime = currentSongTime + stepDuration;
						nextStepTime = nextStepTime + stepDuration;
						if (currentSongTime > song.duration) {
							currentSongTime = currentSongTime - song.duration;
							sendNotes(song, songStart, 0, currentSongTime , audioContext, input, player);
							songStart=songStart+song.duration;
						}
					}
				}, 22);
				setInterval(function () {
					showPosition(song, currentSongTime);
				}, 1234);
			}
			function showPosition(song, currentSongTime) {
				var o = document.getElementById('position');
				o.value = 100 * currentSongTime / song.duration;
				document.getElementById('tmr').innerHTML = '' + Math.round(100 * currentSongTime / song.duration) + '%';
			}
			function sendNotes(song, songStart, start, end, audioContext, input, player) {
				for (var t = 0; t < song.tracks.length; t++) {
					var track = song.tracks[t];
					for (var i = 0; i < track.notes.length; i++) {
						if (track.notes[i].when >= start && track.notes[i].when < end) {
							var when = songStart + track.notes[i].when;
							var duration = track.notes[i].duration;
							if(duration>5){
								duration=5;
							}
							var instr = track.info.variable;
							var v = track.volume / 7;
							var zones=window[instr];
							player.queueWaveTable(audioContext, input, zones, when, track.notes[i].pitch, duration, v,track.notes[i].slides);
						}
					}
				}
				for (var b = 0; b < song.beats.length; b++) {
					var beat = song.beats[b];
					for (var i = 0; i < beat.notes.length; i++) {
						if (beat.notes[i].when >= start && beat.notes[i].when < end) {
							var when = songStart + beat.notes[i].when;
							var duration = 1.5;
							var instr = beat.info.variable;
							var v = beat.volume / 2;
							player.queueWaveTable(audioContext, input, window[instr], when, beat.n, duration, v);
						}
					}
				}
			}
			function findFirstIns(player, nn) {
				for (var i = 0; i < player.loader.instrumentKeys().length; i++) {
					if (nn == 1 * player.loader.instrumentKeys()[i].substring(0, 3)) {
						return i;
					}
				}
			}
			function findFirstDrum(player, nn) {
				for (var i = 0; i < player.loader.drumKeys().length; i++) {
					if (nn == 1 * player.loader.drumKeys()[i].substring(0, 2)) {
						return i;
					}
				}
			}
			function initAudioContext() {
				if (audioContext) {
					//
				} else {
					var AudioContextFunc = window.AudioContext || window.webkitAudioContext;
					audioContext = new AudioContextFunc();
					player = new WebAudioFontPlayer();
					reverberator = player.createReverberator(audioContext);
					reverberator.output.connect(audioContext.destination);
					reverberator.wet.gain.setTargetAtTime(0.95,0,0.0001);
					input = reverberator.input;
					player.adjustPreset(audioContext,myCustomSampledInstrument);
				}
				
			}
			function startLoad() {
				console.log(song);
				initAudioContext();
				for (var i = 0; i < song.tracks.length; i++) {
					var nn = findFirstIns(player, song.tracks[i].program);
					var info = player.loader.instrumentInfo(nn);
					song.tracks[i].info = info;
					song.tracks[i].id = nn;
					player.loader.startLoad(audioContext, info.url, info.variable);
				}
				for (var i = 0; i < song.beats.length; i++) {
					var nn = findFirstDrum(player, song.beats[i].n);
					var info = player.loader.drumInfo(nn);
					song.beats[i].info = info;
					song.beats[i].id = nn;
					player.loader.startLoad(audioContext, info.url, info.variable);
				}
				player.loader.waitLoad(function () {
					console.log('loaded');
					buildControls();
				});
			}
			function buildControls() {
				var o = document.getElementById('cntls');
				var html = '<h2><a href="#" onclick="pause()">Pause/play</a></h2><p id="tmr">&nbsp;</p><p><input id="position" type="range" min="0" max="100" value="0" step="1" /></p>';
				html = html + '<h3>Channels</h3>';
				for (var i = 0; i < song.tracks.length; i++) {
					var v = 100 * song.tracks[i].volume;
					html = html + '<p>' + chooserIns(song.tracks[i].id,i) + '<input id="channel' + i + '" type="range" min="0" max="100" value="' + v + '" step="1" /></p>';
				}
				html = html + '<h3>Drums</h3>';
				for (var i = 0; i < song.beats.length; i++) {
					var v = 100 * song.beats[i].volume;
					html = html + '<p>' + chooserDrum(song.beats[i].id,i) + '<input id="drum' + i + '" type="range" min="0" max="100" value="' + v + '" step="1" /></p>';
				}
				o.innerHTML = html;
				var pos = document.getElementById('position');
				pos.oninput = function (e) {
					player.cancelQueue(audioContext);
					var next = song.duration * pos.value / 100;
					songStart = songStart - (next - currentSongTime);
					currentSongTime = next;
				};
				for (var i = 0; i < song.tracks.length; i++) {
					setVolumeAction(i, song);
				}
				for (var i = 0; i < song.beats.length; i++) {
					setDrVolAction(i, song);
				}
				startPlay();
			}
			function setVolumeAction(i, song) {
				var vlm = document.getElementById('channel' + i);
				vlm.oninput = function (e) {
					player.cancelQueue(audioContext);
					var v = vlm.value / 100;
					if (v < 0.000001) {
						v = 0.000001;
					}
					song.tracks[i].volume = v;
				};
				var sl = document.getElementById('selins' + i);
				sl.onchange = function (e) {
					var nn = sl.value;
					if (nn < 0) {
						song.tracks[i].info = {
							variable:"myCustomSampledInstrument",title:"Custom"
						};
						song.tracks[i].id = nn;
					}
					else {
						var info = player.loader.instrumentInfo(nn);
						player.loader.startLoad(audioContext, info.url, info.variable);
						player.loader.waitLoad(function () {
							console.log('loaded');
							song.tracks[i].info = info;
							song.tracks[i].id = nn;
						});
					}
				};
			}
			function setDrVolAction(i, song) {
				var vlm = document.getElementById('drum' + i);
				vlm.oninput = function (e) {
					player.cancelQueue(audioContext);
					var v = vlm.value / 100;
					if (v < 0.000001) {
						v = 0.000001;
					}
					song.beats[i].volume = v;
				};
				var sl = document.getElementById('seldrm' + i);
				sl.onchange=function(e){
					var nn=sl.value;
					var info = player.loader.drumInfo(nn);					
					player.loader.startLoad(audioContext, info.url, info.variable);
					player.loader.waitLoad(function () {
						console.log('loaded');
						song.beats[i].info = info;
						song.beats[i].id = nn;
					});
				};
			}
			function chooserIns(n,track) {
				var html = '<select id="selins'+track+'">';
				var sel = '';
				html = html + '<option value="-1"' + sel + '>-1: myCustomSampledInstrument</option>';
				for (var i = 0; i < player.loader.instrumentKeys().length; i++) {
					var sel = '';
					if (i == n) {
						sel = ' selected';
					}
					html = html + '<option value="' + i + '"' + sel + '>' + i + ': ' + player.loader.instrumentInfo(i).title + '</option>';
				}
				html = html + '</select>';
				return html;
			}
			function chooserDrum(n,beat) {
				var html = '<select id="seldrm'+beat+'">';
				for (var i = 0; i < player.loader.drumKeys().length; i++) {
					var sel = '';
					if (i == n) {
						sel = ' selected';
					}
					html = html + '<option value="' + i + '"' + sel + '>' + i + ': ' + player.loader.drumInfo(i).title + '</option>';
				}
				html = html + '</select>';
				return html;
			}
			function handleFileSelect(event) {
				console.log(event);
				initAudioContext();
				player.adjustPreset(audioContext,myCustomSampledInstrument);
				var file = event.target.files[0];
				console.log(file);
				var fileReader = new FileReader();
				fileReader.onload = function (progressEvent) {
					console.log(progressEvent);
					var arrayBuffer = progressEvent.target.result;
					console.log(arrayBuffer);
					var midiFile = new MIDIFile(arrayBuffer);
					song = midiFile.parseSong();
					startLoad();
				};
				fileReader.readAsArrayBuffer(file);
			}
			function handleExample(path) {
				console.log(path);
				var xmlHttpRequest = new XMLHttpRequest();
				xmlHttpRequest.open("GET", path, true);
				xmlHttpRequest.responseType = "arraybuffer";
				xmlHttpRequest.onload = function (e) {
					var arrayBuffer = xmlHttpRequest.response;
					var midiFile = new MIDIFile(arrayBuffer);
					song = midiFile.parseSong();
					startLoad();
				};
				xmlHttpRequest.send(null);
			}
		  
		function pushChoice(choice){
			var loadSong = ["midi/voyager.mid","midi/ff6celes.mid","midi/ff6terra.mid","midi/samy02.mid"];
			handleExample(loadSong[choice])
		}
			function playKeyNow(key){
				console.log('playKeyNow',key);
				initAudioContext();
				player.queueWaveTable(audioContext, audioContext.destination, myCustomSampledInstrument, 0, key, 2,0.5);
			}
			document.getElementById('filesinput').addEventListener('change', handleFileSelect, false);
		
		</script>
	</body>
</html>
