<!DOCTYPE html>
<html>
  <head>
    <title>RESUME: SHAWN UUEG</title>
  </head>
  
  <body bgcolor="#333" text="white" topmargin="0" leftmargin="0">
    <br><br>
    


      <! -- This is a Comment; you can see it in the code, but not on the page.
      
      This is similar to the previous layout, but now it's divided into chunks using
      a table. Tables were not originally meant to be used for layout, but instead
      to organize data for science and academia. People quickly found tables to be
      a great way to control the layout of a page and it became widespread and the
      predominant way to design a webpage structure during the first decade of the
      web.
      -->

	<!-- includes for music player -->
	  <!-- midi.js css -->
		  <link href="midi/mplayer.css" rel="stylesheet" type="text/css" />
	  <!-- midi js files -->
	  	  <script src='midi/WebAudioFontPlayer.js'></script>
		  <script src='midi/MIDIFile.js'></script>
	    
      <center>
      <table border=0 width="850" cellpadding="0" cellspacing="0"> 
      <tr>
        
        <td>
          <!-- Left Column -->
	<center>
          <img src="img/code-left.png" width="300"/>
          <br>
		<table width="290"><tr>
			<td> <a href="#" onclick="choosePrior()"><img src="img/backward.png"></a> </td>
			<td width="250" valign="top"><center><span id="p1">Choose a Song?</span> </center></td>
			<td><a href="#" onclick="chooseNext()"><img src="img/forward.png"></a> </td>
			
		</tr></table>
          <table>
            <tr><td>

		

		<script>
			var songChoice = [
				"<a href='#' onclick='pushChoice(0)'>Voyager</a>",
				"<a href='#' onclick='pushChoice(1)'>Celes</a>",
				"<a href='#' onclick='pushChoice(2)'>Terra</a>",
				"<a href='#' onclick='pushChoice(3)'>Samy 2</a>",
				];
			var counter = 0;

			function chooseNext() {
  			   if(counter === songChoice.length -1){
   			       counter = 0;
 			   }
   			   else {
  			       counter++;  
   			   }
			   document.getElementById("p1").innerHTML = songChoice[counter];
			}

			function choosePrior() {
  			   if(counter === 0){
   			       counter = songChoice.length -1;
 			   }
   			   else {
  			       counter = counter -1;  
   			   }
			   document.getElementById("p1").innerHTML = songChoice[counter];
			}


		</script>

   		<div id='cntls'>

		</div>
            <!-- Retro Music Box -->
            <div class="player" style="height: 50px; box-shadow: 0 -1px #000; margin-bottom: 0; border-bottom-right-radius: 0; border-bottom-left-radius: 0;">
        			<table width="275"><tr><td><center>
        				<p><input id="position" type="range" min="0" max="100" value="0" step="1" /></p>
        			</center></td><td><center>
					<div style="margin: 0 auto; width: 150px; float: right;">
        				<a href='#' onclick="go();"><img src="img/play.png" align="absmiddle"></a>
        				<a href='#' onclick="pause();"><img src="img/pause.png" align="absmiddle"></a>
        				<a href='#' onclick="stop();"><img src="img/stop.png" align="absmiddle"></a>
					</center>
        			</td></tr></table>
        			
        		</div>
            </td></tr>
          </table>
	</center>  
        </td>
        
        <td>
          <!-- Right Column -->
          <img src="img/draw-lighthouse.png" width="500" />
          
          <p> 
            &nbsp;&nbsp;&nbsp;<font size="+2" color="#cc9">SHAWN UUEG</font><br>
            <hr>
            &nbsp;&nbsp;&nbsp;<font size="-1">ShaunUueg@hotmail.com</font><br>
            &nbsp;&nbsp;&nbsp;<font size="+1">W. Houston Charter</font>
          </p>
          <p>
            &nbsp;&nbsp;&nbsp;<font size="+1" color="#cc9"><b><i>School-related Activities</i></b></font><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ National Junior Honor Society<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Introductory-level Spanish (1 year)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ School Newspaper - Writer<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Studio Art (8 years)<br>
          </p>
          <p>
            &nbsp;&nbsp;&nbsp;<font size="+1" color="#cc9"><b><i>Out-of-school Activities</i></b></font><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Private Studio Art Lessons (5 years)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Cubscouts - Webelos<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Babysitting<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Karate<br>
          </p>
          <p>
            &nbsp;&nbsp;&nbsp;<font size="+1" color="#cc9"><b><i>Projects</i></b></font><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ North vs South<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Exploding Hot Dogs<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Ronin Warriors Fan Site<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Forgotten Temple<br>
          </p>
          <p>
            &nbsp;&nbsp;&nbsp;<font size="+1" color="#cc9"><b><i>Skills</i></b></font><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ HTML w/ Netscape & Internet Explorer<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Online Hosting Services: Tripod, Angelfire, Geocities<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Claris Works (Mac)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¬ Scenario/Map Editing (Command & Conquer)<br> 
          </p>
            <br>
            
        
        </td>
      </tr>
        <tr><td colspan="2"><hr></td></tr>
      </table>
      
    </center>


		<script>
		console.log('start');
		var audioContext = null;
		var player = null;
		var reverberator = null;
		var equalizer = null;
		var songStart = 0;
		var input = null;
		var currentSongTime = 0;
		var nextStepTime = 0;
		var nextPositionTime = 0;
		var loadedsong = null;
		function go() {
			document.getElementById('cntls').innerHTML = 'starting...';
			try {
				startPlay(loadedsong);
				document.getElementById('cntls').innerHTML = 'playing...';
			} catch (expt) {
				document.getElementById('cntls').innerHTML = 'error ' + expt;
			}
		}
		function startPlay(song) {
			currentSongTime = 0;
			songStart = audioContext.currentTime;
			nextStepTime = audioContext.currentTime;
			var stepDuration = 44 / 1000;
			tick(song, stepDuration);
		}
		function tick(song, stepDuration) {
			if (audioContext.currentTime > nextStepTime - stepDuration) {
				sendNotes(song, songStart, currentSongTime, currentSongTime + stepDuration, audioContext, input, player);
				currentSongTime = currentSongTime + stepDuration;
				nextStepTime = nextStepTime + stepDuration;
				if (currentSongTime > song.duration) {
					currentSongTime = currentSongTime - song.duration;
					sendNotes(song, songStart, 0, currentSongTime, audioContext, input, player);
					songStart = songStart + song.duration;
				}
			}
			if (nextPositionTime < audioContext.currentTime) {
				var o = document.getElementById('position');
				o.value = 100 * currentSongTime / song.duration;
				document.getElementById('tmr').innerHTML = '' + Math.round(100 * currentSongTime / song.duration) + '%';
				nextPositionTime = audioContext.currentTime + 3;
			}
			window.requestAnimationFrame(function (t) {
				tick(song, stepDuration);
			});
		}
		function sendNotes(song, songStart, start, end, audioContext, input, player) {
			for (var t = 0; t < song.tracks.length; t++) {
				var track = song.tracks[t];
				for (var i = 0; i < track.notes.length; i++) {
					if (track.notes[i].when >= start && track.notes[i].when < end) {
						var when = songStart + track.notes[i].when;
						var duration = track.notes[i].duration;
						if (duration > 3) {
							duration = 3;
						}
						var instr = track.info.variable;
						var v = track.volume / 7;
						player.queueWaveTable(audioContext, input, window[instr], when, track.notes[i].pitch, duration, v, track.notes[i].slides);
					}
				}
			}
			for (var b = 0; b < song.beats.length; b++) {
				var beat = song.beats[b];
				for (var i = 0; i < beat.notes.length; i++) {
					if (beat.notes[i].when >= start && beat.notes[i].when < end) {
						var when = songStart + beat.notes[i].when;
						var duration = 1.5;
						var instr = beat.info.variable;
						var v = beat.volume / 2;
						player.queueWaveTable(audioContext, input, window[instr], when, beat.n, duration, v);
					}
				}
			}
		}
		function startLoad(song) {
			console.log(song);
			var AudioContextFunc = window.AudioContext || window.webkitAudioContext;
			audioContext = new AudioContextFunc();
			player = new WebAudioFontPlayer();

			equalizer = player.createChannel(audioContext);
			reverberator = player.createReverberator(audioContext);
			//input = reverberator.input;
			input = equalizer.input;
			equalizer.output.connect(reverberator.input);
			reverberator.output.connect(audioContext.destination);

			for (var i = 0; i < song.tracks.length; i++) {
				var nn = player.loader.findInstrument(song.tracks[i].program);
				var info = player.loader.instrumentInfo(nn);
				song.tracks[i].info = info;
				song.tracks[i].id = nn;
				player.loader.startLoad(audioContext, info.url, info.variable);
			}
			for (var i = 0; i < song.beats.length; i++) {
				var nn = player.loader.findDrum(song.beats[i].n);
				var info = player.loader.drumInfo(nn);
				song.beats[i].info = info;
				song.beats[i].id = nn;
				player.loader.startLoad(audioContext, info.url, info.variable);
			}
			player.loader.waitLoad(function () {
				console.log('buildControls');
				buildControls(song);
				resetEqlualizer();
			});
		}
		function resetEqlualizer(){
			equalizer.band32.gain.setTargetAtTime(2,0,0.0001);
			equalizer.band64.gain.setTargetAtTime(2,0,0.0001);
			equalizer.band128.gain.setTargetAtTime(1,0,0.0001);
			equalizer.band256.gain.setTargetAtTime(0,0,0.0001);
			equalizer.band512.gain.setTargetAtTime(-1,0,0.0001);
			equalizer.band1k.gain.setTargetAtTime(5,0,0.0001);
			equalizer.band2k.gain.setTargetAtTime(4,0,0.0001);
			equalizer.band4k.gain.setTargetAtTime(3,0,0.0001);
			equalizer.band8k.gain.setTargetAtTime(-2,0,0.0001);
			equalizer.band16k.gain.setTargetAtTime(2,0,0.0001);
		}
		function buildControls(song) {
			audioContext.resume();
			var o = document.getElementById('cntls');
			var html = '<h2 id="wrng">Refresh browser page to load another song</h2>';
			html = html + '<p id="tmr"><button onclick="go();">Play</button></p>';
			html = html + '<p><input id="position" type="range" min="0" max="100" value="0" step="1" /></p>';
			html = html + '<h3>Channels</h3>';
			for (var i = 0; i < song.tracks.length; i++) {
				var v = 100 * song.tracks[i].volume;
				html = html + '<p>' + chooserIns(song.tracks[i].id, i) + '<input id="channel' + i + '" type="range" min="0" max="100" value="' + v + '" step="1" /></p>';
			}
			html = html + '<h3>Drums</h3>';
			for (var i = 0; i < song.beats.length; i++) {
				var v = 100 * song.beats[i].volume;
				html = html + '<p>' + chooserDrum(song.beats[i].id, i) + '<input id="drum' + i + '" type="range" min="0" max="100" value="' + v + '" step="1" /></p>';
			}
			o.innerHTML = html;
			console.log('Loaded');
			var pos = document.getElementById('position');
			pos.oninput = function (e) {
				if (loadedsong) {
					player.cancelQueue(audioContext);
					var next = song.duration * pos.value / 100;
					songStart = songStart - (next - currentSongTime);
					currentSongTime = next;
				}
			};
			console.log('Tracks');
			for (var i = 0; i < song.tracks.length; i++) {
				setVolumeAction(i, song);
			}
			console.log('Drums');
			for (var i = 0; i < song.beats.length; i++) {
				setDrVolAction(i, song);
			}
			loadedsong = song;
		}
		function setVolumeAction(i, song) {
			var vlm = document.getElementById('channel' + i);
			vlm.oninput = function (e) {
				player.cancelQueue(audioContext);
				var v = vlm.value / 100;
				if (v < 0.000001) {
					v = 0.000001;
				}
				song.tracks[i].volume = v;
			};
			var sl = document.getElementById('selins' + i);
			sl.onchange = function (e) {
				var nn = sl.value;
				var info = player.loader.instrumentInfo(nn);
				player.loader.startLoad(audioContext, info.url, info.variable);
				player.loader.waitLoad(function () {
					console.log('loaded');
					song.tracks[i].info = info;
					song.tracks[i].id = nn;
				});
			};
		}
		function setDrVolAction(i, song) {
			var vlm = document.getElementById('drum' + i);
			vlm.oninput = function (e) {
				player.cancelQueue(audioContext);
				var v = vlm.value / 100;
				if (v < 0.000001) {
					v = 0.000001;
				}
				song.beats[i].volume = v;
			};
			var sl = document.getElementById('seldrm' + i);
			sl.onchange = function (e) {
				var nn = sl.value;
				var info = player.loader.drumInfo(nn);
				player.loader.startLoad(audioContext, info.url, info.variable);
				player.loader.waitLoad(function () {
					console.log('loaded');
					song.beats[i].info = info;
					song.beats[i].id = nn;
				});
			};
		}
		function chooserIns(n, track) {
			var html = '<select id="selins' + track + '">';
			for (var i = 0; i < player.loader.instrumentKeys().length; i++) {
				var sel = '';
				if (i == n) {
					sel = ' selected';
				}
				html = html + '<option value="' + i + '"' + sel + '>' + i + ': ' + player.loader.instrumentInfo(i).title + '</option>';
			}
			html = html + '</select>';
			return html;
		}
		function chooserDrum(n, beat) {
			var html = '<select id="seldrm' + beat + '">';
			for (var i = 0; i < player.loader.drumKeys().length; i++) {
				var sel = '';
				if (i == n) {
					sel = ' selected';
				}
				html = html + '<option value="' + i + '"' + sel + '>' + i + ': ' + player.loader.drumInfo(i).title + '</option>';
			}
			html = html + '</select>';
			return html;
		}
		function handleFileSelect(event) {
			console.log(event);
			var file = event.target.files[0];
			console.log(file);
			var fileReader = new FileReader();
			fileReader.onload = function (progressEvent) {
				console.log(progressEvent);
				var arrayBuffer = progressEvent.target.result;
				console.log(arrayBuffer);
				var midiFile = new MIDIFile(arrayBuffer);
				var song = midiFile.parseSong();
				startLoad(song);
			};
			fileReader.readAsArrayBuffer(file);
		}
		function handleExample(path) {
			console.log(path);
			var xmlHttpRequest = new XMLHttpRequest();
			xmlHttpRequest.open("GET", path, true);
			xmlHttpRequest.responseType = "arraybuffer";
			xmlHttpRequest.onload = function (e) {
				var arrayBuffer = xmlHttpRequest.response;
				var midiFile = new MIDIFile(arrayBuffer);
				var song = midiFile.parseSong();
				startLoad(song);
			};
			xmlHttpRequest.send(null);
		}
		function pushChoice(choice){
			var loadSong = ["midi/voyager.mid","midi/ff6celes.mid","midi/ff6terra.mid","midi/samy02.mid"];
			handleExample(loadSong[choice])
		}
		document.getElementById('filesinput').addEventListener('change', handleFileSelect, false);
	</script>
    
  </body>
</html>
